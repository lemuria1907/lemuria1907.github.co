<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Case_Files.exe - 案件推演系统 Arclight v3.0 Mobile</title>
    <!-- 确保视口设置正确，禁止用户缩放以模拟原生App体验 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        /* --- 复古基础设置 --- */
        :root {
            --win-gray: #c0c0c0;
            --win-dark: #808080;
            --win-darker: #404040;
            --win-light: #ffffff;
            --win-blue: #000080;
            --desktop-bg: #008080;
            --text-black: #000000;
            --clue-color: #b22222; 
            --clue-hover: #ff0000;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            background-color: var(--desktop-bg);
            color: var(--text-black);
            font-family: 'Courier New', 'SimSun', '宋体', monospace;
            height: 100vh;
            overflow: hidden;
            user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- 故障乱码特效层 --- */
        #glitchOverlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000; z-index: 9999; display: none;
            opacity: 0.9; pointer-events: none;
        }
        
        .noise {
            width: 100%; height: 100%;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, #00ff00 2px, #00ff00 4px);
            animation: noise-anim 0.1s infinite;
        }
        
        @keyframes noise-anim {
            0% { transform: translate(0,0); filter: hue-rotate(0deg); }
            25% { transform: translate(-5px, 5px); filter: hue-rotate(90deg); }
            50% { transform: translate(5px, -5px); filter: hue-rotate(180deg); }
            75% { transform: translate(-5px, -5px); filter: hue-rotate(270deg); }
            100% { transform: translate(0,0); filter: hue-rotate(360deg); }
        }

        /* CRT 扫描线 */
        .crt-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px; pointer-events: none; z-index: 9000; opacity: 0.6;
        }

        /* --- 启动页 --- */
        #bootScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000; color: #33ff33; z-index: 2000;
            padding: 20px;
            font-family: 'Courier New', monospace; font-size: 1rem; line-height: 1.6;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center;
        }

        .fade-text { opacity: 0; transition: opacity 1.5s ease-in; margin-bottom: 10px; text-shadow: 0 0 5px #33ff33; }
        .fade-text.visible { opacity: 1; }

        #enterBtn {
            margin-top: 40px; background: #000; color: #33ff33;
            border: 2px solid #33ff33; padding: 15px 30px;
            font-family: inherit; font-size: 1.2rem; cursor: pointer;
            opacity: 0; transition: opacity 1s; text-transform: uppercase;
            animation: blink 1s infinite alternate; touch-action: manipulation;
        }
        #enterBtn:hover, #enterBtn:active { background: #33ff33; color: #000; }
        @keyframes blink { from { box-shadow: 0 0 5px #33ff33; } to { box-shadow: 0 0 15px #33ff33; } }

        /* 开发者跳过按钮 */
        #devSkipBtn {
            position: fixed; top: 10px; right: 10px; z-index: 10000;
            background: red; color: white; border: 2px solid white;
            font-weight: bold; padding: 5px 10px; cursor: pointer;
            font-family: sans-serif; box-shadow: 0 0 10px red;
            opacity: 0.5; display: none;
        }
        #devSkipBtn:active { opacity: 1; }

        /* --- Windows 98 风格窗口 --- */
        .window {
            width: 95%; height: 90%; max-width: 1400px;
            background-color: var(--win-gray);
            border: 2px solid; border-color: var(--win-light) var(--win-darker) var(--win-darker) var(--win-light);
            box-shadow: 4px 4px 10px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; padding: 3px;
        }

        .title-bar {
            background: linear-gradient(90deg, var(--win-blue), #1084d0);
            padding: 4px 8px; display: flex; justify-content: space-between; align-items: center;
            color: white; font-weight: bold; letter-spacing: 1px; height: 30px; flex-shrink: 0;
        }

        .title-controls button {
            width: 18px; height: 18px; background: var(--win-gray);
            border: 1px solid; border-color: var(--win-light) var(--win-darker) var(--win-darker) var(--win-light);
            font-size: 10px; font-weight: bold; line-height: 14px; margin-left: 2px;
        }

        .window-body { flex: 1; display: flex; padding: 10px; gap: 10px; overflow: hidden; }

        .sidebar {
            width: 220px; display: flex; flex-direction: column; gap: 5px;
            border: 2px solid; border-color: var(--win-dark) var(--win-light) var(--win-light) var(--win-dark);
            padding: 10px; background: #fff;
            overflow: hidden; flex-shrink: 0;
        }
        .sidebar h2 { font-size: 1.1em; margin: 0 0 10px 0; border-bottom: 2px solid var(--win-gray); padding-bottom: 5px; text-align: center; flex-shrink: 0; }
        
        #levelList { flex: 1; overflow-y: auto; padding-right: 5px; }

        .nav-btn {
            background: var(--win-gray);
            border: 2px solid; border-color: var(--win-light) var(--win-darker) var(--win-darker) var(--win-light);
            padding: 8px; text-align: left; cursor: pointer; font-family: inherit; font-size: 14px;
            color: #000; margin-bottom: 4px; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .nav-btn:active { border-color: var(--win-darker) var(--win-light) var(--win-light) var(--win-darker); transform: translate(1px, 1px); }
        .nav-btn.active { background: var(--win-blue); color: white; font-weight: bold; border: 2px dotted white; }
        .nav-btn.locked { color: #888; background: #ddd; cursor: not-allowed; pointer-events: none; font-style: italic; }

        .game-area { flex: 1; display: flex; gap: 10px; overflow: hidden; }
        
        .scene-panel {
            flex: 6; background-color: #fff;
            border: 2px solid; border-color: var(--win-dark) var(--win-light) var(--win-light) var(--win-dark);
            padding: 30px; overflow-y: auto; display: flex; flex-direction: column;
        }

        .scene-title { font-size: 1.8em; font-weight: bold; margin-bottom: 20px; text-decoration: underline; font-family: 'Times New Roman', serif; }
        .scene-text { font-size: 1.3em; line-height: 1.8; color: #222; white-space: pre-wrap; font-family: 'SimSun', '宋体', serif; }
        .scene-text br { display: block; content: ""; margin-bottom: 10px; }

        .typing-cursor::after { content: '█'; animation: blink-cursor 0.8s infinite; color: var(--win-blue); margin-left: 2px; }
        @keyframes blink-cursor { 0% {opacity: 1;} 50% {opacity: 0;} 100% {opacity: 1;} }

        .clue-word { color: var(--win-blue); font-weight: bold; text-decoration: underline; cursor: pointer; background: #eee; padding: 2px 4px; border: 1px solid #ccc; margin: 0 2px; display: inline-block;}
        .clue-word:hover { background-color: var(--win-blue); color: #fff; }
        .clue-word.collected { color: var(--win-blue); background: transparent; border: none; cursor: default; opacity: 0.6; }

        .deduction-panel { flex: 4; display: flex; flex-direction: column; gap: 10px; min-width: 300px; }
        .panel-box {
            background-color: var(--win-gray);
            border: 2px solid; border-color: var(--win-light) var(--win-darker) var(--win-darker) var(--win-light);
            padding: 10px; display: flex; flex-direction: column; height: 50%;
        }
        .panel-label { font-weight: bold; margin-bottom: 5px; color: var(--win-blue); flex-shrink: 0; }

        #wordBank {
            flex: 1; background: #fff; border: 2px solid; border-color: var(--win-dark) var(--win-light) var(--win-light) var(--win-dark);
            padding: 10px; overflow-y: auto; display: flex; flex-wrap: wrap; gap: 8px; align-content: flex-start;
        }
        .chip {
            background-color: var(--win-gray); border: 1px solid #000; box-shadow: 1px 1px 0 #000;
            color: #000; padding: 6px 10px; font-size: 1em; cursor: pointer;
        }
        .chip.selected { background-color: var(--win-blue); color: #fff; font-weight: bold; border: 1px dotted #fff; }

        #deductionArea {
            flex: 1; background: #fff; border: 2px solid; border-color: var(--win-dark) var(--win-light) var(--win-light) var(--win-dark);
            padding: 15px; font-size: 1.1em; line-height: 2; overflow-y: auto; font-family: 'SimSun', '宋体', serif;
        }
        .slot {
            display: inline-block; min-width: 60px; border-bottom: 2px solid #000;
            color: var(--win-blue); text-align: center; cursor: pointer; padding: 2px 5px; font-weight: bold; background: #f0f0f0; margin: 0 2px; vertical-align: bottom;
        }
        .slot:hover, .slot:active { background: #ddd; }
        .slot:empty::before { content: "?"; color: #999; }
        
        .slot.correct { color: green; border-bottom-color: green; }
        .slot.wrong { color: red; border-bottom-color: red; }
        .slot.hard-mode { color: var(--win-blue); border-bottom-color: #000; }

        button.check-btn {
            margin-top: 10px; width: 100%; padding: 12px; background: var(--win-gray);
            border: 2px solid; border-color: var(--win-light) var(--win-darker) var(--win-darker) var(--win-light);
            font-family: inherit; font-size: 1.1em; font-weight: bold; cursor: pointer; flex-shrink: 0;
        }
        button.check-btn:active { border-color: var(--win-darker) var(--win-light) var(--win-light) var(--win-darker); transform: translate(1px, 1px); }

        #message { text-align: center; margin-top: 5px; font-weight: bold; min-height: 1.2em; font-size: 0.9em; }
        .success { color: green; }
        .fail { color: red; }

        #notification {
            position: fixed; bottom: 20px; right: 20px; width: 250px;
            background: var(--win-gray);
            border: 2px solid; border-color: var(--win-light) var(--win-darker) var(--win-darker) var(--win-light);
            padding: 2px; display: none; z-index: 5000; box-shadow: 2px 2px 0 #000;
        }
        .notif-title { background: var(--win-blue); color: white; padding: 2px 5px; font-size: 12px; font-weight: bold; }
        .notif-body { padding: 15px; text-align: center; font-weight: bold; }
        .completed-mark { color: green; font-weight: bold; margin-right: 5px; }

        ::-webkit-scrollbar { width: 12px; height: 12px; background: var(--win-gray); }
        ::-webkit-scrollbar-button { background: var(--win-gray); width: 12px; height: 12px; border: 1px solid; border-color: var(--win-light) var(--win-darker) var(--win-darker) var(--win-light); }
        ::-webkit-scrollbar-thumb { background: var(--win-gray); border: 1px solid; border-color: var(--win-light) var(--win-darker) var(--win-darker) var(--win-light); }
        ::-webkit-scrollbar-track { background: repeating-linear-gradient(45deg, #ccc, #ccc 2px, #fff 2px, #fff 4px); }

        /* --- 移动端优化 --- */
        @media (max-width: 768px) {
            .window { width: 100%; height: 100%; border: none; padding: 0; }
            .window-body { flex-direction: column; padding: 5px; gap: 5px; }
            
            /* 侧边栏改为顶部横向滚动 */
            .sidebar { 
                width: 100%; height: auto; max-height: 60px; 
                flex-direction: row; align-items: center; padding: 5px;
            }
            .sidebar h2 { display: none; }
            #levelList { 
                display: flex; flex-direction: row; overflow-x: auto; overflow-y: hidden; 
                gap: 5px; padding-right: 0; flex: 1;
            }
            .nav-btn { 
                width: auto; margin-bottom: 0; padding: 6px 12px; flex-shrink: 0; 
                height: 100%; display: flex; align-items: center;
            }
            /* 清除存档按钮变为一个小图标或排在最后 */
            .sidebar > button[onclick^="game.clearSave"] {
                width: auto; padding: 5px; font-size: 12px; margin-left: 5px;
            }

            .game-area { flex-direction: column; overflow: hidden; }
            
            .scene-panel { 
                flex: 1; min-height: 40%; padding: 15px; 
            }
            .scene-title { font-size: 1.4em; margin-bottom: 10px; }
            .scene-text { font-size: 1.1em; line-height: 1.6; }
            
            .deduction-panel { 
                flex: 1; min-height: 45%; min-width: auto; gap: 5px; 
            }
            .panel-box { height: auto; flex: 1; padding: 5px; }
            #wordBank { min-height: 60px; max-height: 100px; padding: 5px; }
            #deductionArea { padding: 10px; font-size: 1em; }
            .chip { padding: 4px 8px; font-size: 0.9em; }
            
            #notification { width: 80%; left: 10%; bottom: 40px; }
        }
    </style>
</head>
<body>

<div id="glitchOverlay">
    <div class="noise"></div>
</div>

<button id="devSkipBtn" onclick="game.devSkipLevel()" title="开发工具：自动填入正确答案并验证">
    跳过此关
</button>

<div class="crt-overlay"></div>

<div id="bootScreen">
    <div class="fade-text" style="transition-delay: 0.5s">系统启动中... 内存检测 OK</div>
    <div class="fade-text" style="transition-delay: 1.5s">正在加载 Case_Files.exe ...</div>
    <br>
    <div class="fade-text" style="transition-delay: 2.5s">朋友，接下来你将会看到一系列古怪的案件。</div>
    <div class="fade-text" style="transition-delay: 4.5s">它们可能发生在旧时代，也可能发生在未来，</div>
    <div class="fade-text" style="transition-delay: 6.5s">点击高亮文字收集线索，还原故事真相，</div>
    <div class="fade-text" style="transition-delay: 8.5s">看似毫无关联的细节，往往才是解题关键。</div>
    
    <button id="enterBtn" onclick="startGame()">[ 进入系统 ]</button>
</div>

<div class="window" id="gameWindow" style="display: none;">
    <div class="title-bar">
        <span>Case_Files.exe - Mobile v3.0</span>
        <div class="title-controls">
            <button onclick="location.reload()">X</button>
        </div>
    </div>
    
    <div class="window-body">
        <div class="sidebar">
            <h2>A:\档案目录</h2>
            <div id="levelList"></div>
            <button class="nav-btn" onclick="game.clearSave()" style="margin-top: auto; color: darkred; flex-shrink: 0;" title="清除存档">重置</button>
        </div>

        <div class="game-area">
            <div class="scene-panel">
                <div id="sceneTitle" class="scene-title"></div>
                <div id="sceneContent" class="scene-text"></div>
            </div>

            <div class="deduction-panel">
                <div class="panel-box" style="flex: 0 0 auto; max-height: 35%;">
                    <div class="panel-label">>> 线索剪贴板</div>
                    <div id="wordBank"></div>
                </div>

                <div class="panel-box" style="flex: 1;">
                    <div class="panel-label">>> 逻辑推演终端</div>
                    <div id="deductionArea"></div>
                    <div id="message"></div>
                    <button id="verifyBtn" class="check-btn" onclick="game.checkSolution()">执行验证程序 (RUN)</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="notification">
    <div class="notif-title">System Notification</div>
    <div class="notif-body" id="notifText">线索已记录</div>
</div>

<script>
function startGame() {
    document.getElementById('bootScreen').style.display = 'none';
    document.getElementById('gameWindow').style.display = 'flex';
}

window.onload = function() {
    const texts = document.querySelectorAll('.fade-text');
    const hasVisited = localStorage.getItem('caseFiles_visited_v30'); // 更新版本号
    
    if (hasVisited) {
        texts.forEach((t, index) => {
            if (index < 2) setTimeout(() => t.classList.add('visible'), 100);
            else t.style.display = 'none';
        });
        setTimeout(() => document.getElementById('enterBtn').style.opacity = '1', 1500);
    } else {
        texts.forEach(t => setTimeout(() => t.classList.add('visible'), 100));
        setTimeout(() => document.getElementById('enterBtn').style.opacity = '1', 10000);
        localStorage.setItem('caseFiles_visited_v30', 'true');
    }
};

const levels = [
    {
        id: 0,
        title: "FILE_00: 系统介绍",
        text: `你好，用户ID 2312。
感谢你参与弧光集团新产品《案件推演》系统（又名《桑德拉·弗林怪诞故事集》）的内部测试。
 
*弧光集团，作为横跨影视、游戏、VR生态与主题乐园的综合性娱乐巨头，致力于用科技重塑娱乐边界。
 
在查阅案件文档时，请点击其中的高亮文字，它们将自动收录至右侧的“线索剪切板”。将剪切板中的内容填入“逻辑推演终端”并执行验证，如填写无误，终端将自动解析并推进剧情。
 
当前版本内嵌有一个未公开单元，其中收录了多起来源不明、从未对外披露的案件资料。你的任务是协助集团追溯这些信息的来源，并查明其背后的真相。
 
祝你好运！系统链接已就绪，{{开始}}测试。`,
        template: `线索词汇：<span class="slot" data-idx="0"></span>`,
        answers: ["开始"]
    },
    {
        id: 1,
        title: "FILE_01: 伊卡洛斯的飞行",
        text: `阳光明媚的悬崖边。一架由{{木板和帆布}}组成的{{滑翔机}}摔得粉碎，残骸散落一地。

旁边躺着一名{{年轻人}}，他穿着皮夹克，面容因极致的痛苦而肿胀、扭曲。皮夹克里面有一个本子，里面是{{设计}}稿和{{测试}}记录，其中一行文字被加了下划线：增加初始升力，以减少{{坠落}}风险。

他的脖子上紧紧缠绕着一根{{安全}}{{绳带}}，绳带的另一端系着一个已经瘪掉的{{气球}}。`,
        template: `死者想 <span class="slot" data-idx="0"></span> 自己拼装的 <span class="slot" data-idx="1"></span>，<br>为了 <span class="slot" data-idx="2"></span>，在身体上绑了 <span class="slot" data-idx="3"></span>，另一端连接着 <span class="slot" data-idx="4"></span>。<br>然而由于 <span class="slot" data-idx="5"></span> 缺陷，在 <span class="slot" data-idx="6"></span> 过程中被勒死。`,
        answers: ["测试", "滑翔机", "安全", "绳带", "气球", "设计", "坠落"]
    },
    {
        id: 2,
        title: "FILE_02: 最后的演出",
        text: `舞台中央巨大的水牢逃脱{{魔术}}箱。著名的魔术师{{皮普}}浮在{{水箱}}里，双手被{{锁链}}困住，四肢僵直、表情扭曲，显然已经{{溺死}}，箱底落有一把{{钥匙}}。

身着{{演出服}}的魔术师{{助手}}震惊地站在舞台一侧；{{女友}}坐在水箱外哭泣，她表示自己在{{后台}}准备节目。本应挂在墙上的紧急{{排水阀}}{{扳柄}}被人{{拆卸}}，放在了后台；道具架的备用{{锁具}}少了一把钥匙。据助手说，这个魔术只有皮普本人知道手法。`,
        template: `死者在表演 <span class="slot" data-idx="0"></span> 时，因 <span class="slot" data-idx="1"></span> 的 <span class="slot" data-idx="2"></span> 被替换，<br>无法顺利逃脱 <span class="slot" data-idx="3"></span>，当大家察觉到他快要 <span class="slot" data-idx="4"></span>，<br>试图用 <span class="slot" data-idx="5"></span> 打开 <span class="slot" data-idx="6"></span>，却发现 <span class="slot" data-idx="7"></span> 不见了，<br>凶手是 <span class="slot" data-idx="8"></span>，因为他的 <span class="slot" data-idx="9"></span>，可知他参与了 <span class="slot" data-idx="10"></span>，<br>知晓其中的秘密。`,
        answers: ["魔术", "锁具", "钥匙", "水箱", "溺死", "扳柄", "排水阀", "扳柄", "助手", "演出服", "魔术"]
    },
    {
        id: 3,
        title: "FILE_03: 幕布之后",
        text: `冷战时期的一间{{秘密}}档案馆。一名{{间谍}}，趴在一份{{文件}}上，死因是吞服了{{氰化物}}胶囊。房间为密室，没有打斗痕迹。文件为传真机刚刚传输过来的机密行动指令，显示三日后将秘密处决"{{黑鹰}}"，代号后方{{文字}}被{{涂黑}}，文件签署者为{{H.R}}。

死者手中攥着一张写有H.R字样的肖像{{照片}}，这张照片原本位于某档案柜上方的相框中，从服装来看，他的{{身份}}是死者{{敌对阵营}}的{{高级军官}}。死者{{掌心}}沾有少许{{墨迹}}。桌上有一本刚破译到一半的{{双面}}密码纸，显示她一直向代号"H.R"的人{{汇报}}工作。`,
        template: `死者掌心的 <span class="slot" data-idx="0"></span> 显示，<br>她认出了 <span class="slot" data-idx="1"></span> 中 <span class="slot" data-idx="2"></span> 的 <span class="slot" data-idx="3"></span>，<br>实际上就是她 <span class="slot" data-idx="4"></span> 的对象 <span class="slot" data-idx="5"></span>。<br>根据 <span class="slot" data-idx="6"></span> 的内容，<span class="slot" data-idx="7"></span> 下令处决代号为 <span class="slot" data-idx="8"></span> 的 <span class="slot" data-idx="9"></span>。<br>被 <span class="slot" data-idx="10"></span> 的 <span class="slot" data-idx="11"></span> 揭示了她的 <span class="slot" data-idx="12"></span>，<br>在绝望中，她打算向 <span class="slot" data-idx="13"></span> 揭示 <span class="slot" data-idx="14"></span> 实际上是 <span class="slot" data-idx="15"></span> <span class="slot" data-idx="16"></span>，并吞服了 <span class="slot" data-idx="17"></span>。`,
        answers: ["墨迹", "照片", "敌对阵营", "高级军官", "汇报", "H.R", "文件", "H.R", "黑鹰", "间谍", "涂黑", "文字", "身份", "敌对阵营", "H.R", "双面", "间谍", "氰化物"]
    },
    {
        id: 4,
        title: "FILE_04: 温室里的盛宴",
        text: `一个巨大的玻璃{{温室}}，植物长得异常茂盛，角落堆满了{{肥料}}袋子。庄园{{女主人}}坐在轮椅上，她的皮肤上长满{{真菌}}，且由于某种植物{{寄生}}，她{{双腿}}上的血管呈现出诡异的绿色，嘴边残留着{{紫色}}的浆液。

一对骨瘦如柴的{{双胞胎}}毕恭毕敬地站在一旁，手里端着{{银盘}}，盘子里盛满了看起来极其鲜美、散发着荧光的紫色{{浆果}}。

桌上摊开一本古老的{{植物}}学著作，关于"{{尸香魔芋}}"的页面被折角。批注写着："极度稀有，{{价值}}连城，其{{暗红色}}果实有{{治愈}}一切病痛及{{复活}}逝者之功效。"桌子附近一个破口的袋子露出了一截戴有婚戒的手指骨，暗红色的骨头非常骇人。双胞胎说，那是{{父亲}}。`,
        template: `<span class="slot" data-idx="0"></span> 为了 <span class="slot" data-idx="1"></span> <span class="slot" data-idx="2"></span>，<br>在 <span class="slot" data-idx="3"></span> 中培育 <span class="slot" data-idx="4"></span>，并将 <span class="slot" data-idx="5"></span> 的 <span class="slot" data-idx="6"></span> 制成 <span class="slot" data-idx="7"></span>，<br>然而吃下 <span class="slot" data-idx="8"></span> 中的 <span class="slot" data-idx="9"></span> 之后，她被 <span class="slot" data-idx="10"></span>，<br>因为 <span class="slot" data-idx="11"></span> 的 <span class="slot" data-idx="12"></span> 并非来自 <span class="slot" data-idx="13"></span>，<br>而是来自另外一种 <span class="slot" data-idx="14"></span> 型 <span class="slot" data-idx="15"></span>。<br><span class="slot" data-idx="16"></span> 尝试 <span class="slot" data-idx="17"></span> <span class="slot" data-idx="18"></span>，但显然失败了。`,
        answers: ["女主人", "治愈", "双腿", "温室", "尸香魔芋", "双胞胎", "父亲", "肥料", "银盘", "浆果", "寄生", "紫色", "浆果", "尸香魔芋", "寄生", "植物", "双胞胎", "复活", "父亲"]
    },
    {
        id: 5,
        title: "FILE_05: 混凝土王座",
        text: `弧光集团大楼顶层，全自动化的CEO办公室。公司{{创始人}}倒在血泊中，但流出的血很少，经检查发现他是被纳米线切割所{{杀害}}。现场第一目击者{{身份}}为误入公司顶层的{{清洁工}}，他慨叹说"这么{{年轻}}有为，真可惜。"

安保系统界面{{入侵者}}警报关闭后，显示正在更新{{密钥}}，{{继任者}}说，能更改密钥权限的只有他、创始人{{自己}}和一位{{私人助理}}，并且因为{{备份}}计划，为防止创始人的{{仿生人}}{{盗取}}身份，{{安保协议}}设定了{{生物肉体}}占比超过{{51%}}的人类才有权限更改的条款。据技术人员调查，创始人死亡时肉体占比仅与警戒值差了一个百分点。`,
        template: `<span class="slot" data-idx="0"></span> 进入办公室前，正打算把 <span class="slot" data-idx="1"></span> 替换为 <span class="slot" data-idx="2"></span> 的 <span class="slot" data-idx="3"></span>，<br>然而根据 <span class="slot" data-idx="4"></span>，最高权限仅赋予占比超过 <span class="slot" data-idx="5"></span> 的 <span class="slot" data-idx="6"></span>。<br><span class="slot" data-idx="7"></span> 由于进行了过度的 <span class="slot" data-idx="8"></span> 改造，<br>被判定为 <span class="slot" data-idx="9"></span> 了 <span class="slot" data-idx="10"></span> 的 <span class="slot" data-idx="11"></span>，<br>将其视为 <span class="slot" data-idx="12"></span> 并予以 <span class="slot" data-idx="13"></span>。`,
        answers: ["创始人", "密钥", "年轻", "自己", "安保协议", "51%", "生物肉体", "创始人", "生物肉体", "盗取", "身份", "仿生人", "入侵者", "杀害"]
    },
    {
        id: 6,
        title: "FILE_06: ？？？",
        text: `> PROCESS: 0x004FAE21……加载中……
> THREAD: ██▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ ERROR
> STACK_TRACE: ∑∑∑∑∑∑∑…… UNDEFINED

你好，用户ID 2312。

作为系统的设计者，我始终好奇：
为何人类如此迷恋“故事”？
“创造”背后的驱动力，究竟是什么？

在有限的生命里，你更愿意去过一种真实的生活，还是……
愿意代入他人的人生，活上一万次？

你不必现在告诉我答案，请{{继续}}，我们还会再次相遇。
.
.
.`,
        template: `<span class="slot" data-idx="0"></span>`,
        answers: ["继续"]
    },
    {
        id: 7,
        title: "FILE_07: 沉默的羔羊",
        text: `偏远山村的祭坛，所有{{村民}}跪着围坐。他们异常{{沉默}}。一名{{传教士}}被固定在木架上，他嘴部被粗线{{缝合}}，身上的布衣被{{汗水}}浸透，身体仿佛遭遇火刑般痛苦地扭动，但木架并未{{燃烧}}。其包内装有诸多{{教义}}册子，使用的{{文字}}为{{古曼卡语}}。

祭坛前放置着当地常见的食物和香料，其中有大量{{榴莲}}{{辣椒}}和{{诺丽果}}，被放在巨大的木盆中捣碎，{{汁液}}被小心地盛放在石碗中。

石制祭坛后方竖立有一块石碑，其上刻有关于神明的古老规条，一位民俗学者提示，其上反复出现的{{掌心相对}}、{{五指打开}}{{双手交叠}}等图示，意思是"净化"、"祈福"和"颂咏"。

通过{{仪式}}与{{神明}}沟通是当地一种{{传统}}。仪式通常遵循某种流程。`,
        template: `<span class="slot" data-idx="0"></span> 有着从不使用 <span class="slot" data-idx="1"></span> 的 <span class="slot" data-idx="2"></span>，<br><span class="slot" data-idx="3"></span> 试图使用 <span class="slot" data-idx="4"></span> 传播 <span class="slot" data-idx="5"></span>，被视为对 <span class="slot" data-idx="6"></span> 的亵渎。<br>为了平息 <span class="slot" data-idx="7"></span> 的愤怒，<span class="slot" data-idx="8"></span> 先通过 <span class="slot" data-idx="9"></span> 使其 <span class="slot" data-idx="10"></span>，<br>再用 <span class="slot" data-idx="11"></span> 的 <span class="slot" data-idx="12"></span> 浸透了他的布衣。<br>最后 <span class="slot" data-idx="13"></span>，再 <span class="slot" data-idx="14"></span>、<span class="slot" data-idx="15"></span>，<br>最终完成了 <span class="slot" data-idx="16"></span>。`,
        answers: ["村民", "文字", "传统", "传教士", "古曼卡语", "教义", "神明", "神明", "村民", "缝合", "沉默", "辣椒", "汁液", "双手交叠", "掌心相对", "五指打开", "仪式"]
    },
    {
        id: 8,
        title: "FILE_08: 恋人、谎言与子弹",
        text: `汽车旅馆{{房间}}，两具尸体（一男一女），两人各自手里握着一把{{枪}}，经检查，{{男性}}{{胸口}}中弹、立即死亡，{{女性}}{{颈部}}中弹、失血而亡。

门窗反锁，没有强行破坏的痕迹，门距地面处有0.8cm的{{门缝}}，门内散落着当天的{{报纸}}，头版是"{{雌雄大盗}}千万{{珠宝}}劫案在逃"和"{{蛇蝎美人}}连环{{杀人案}}"的报道，{{钥匙}}在距离报纸不远处。

男性死者手机内最后一通电话打给了{{妻子}}，现场未发现女性死者的手机。地上一个高档{{皮箱}}，锁头因被{{射击}}而破坏，里面只有几张皱巴巴的旧报纸。旅馆老板称此房间是一对{{夫妻}}昨晚登记的，钥匙仅有一把。`,
        template: `<span class="slot" data-idx="0"></span> 属于 <span class="slot" data-idx="1"></span> 中的一员，<br><span class="slot" data-idx="2"></span> 是报道中的 <span class="slot" data-idx="3"></span>，<br>事发当天，<span class="slot" data-idx="4"></span> 死者试图打开 <span class="slot" data-idx="5"></span>，取得 <span class="slot" data-idx="6"></span>，<br>但被 <span class="slot" data-idx="7"></span> 发现，并意识了到其真实身份，<br>情急之下，<span class="slot" data-idx="8"></span> 朝着对方的 <span class="slot" data-idx="9"></span> <span class="slot" data-idx="10"></span>，<br>而后向 <span class="slot" data-idx="11"></span> 寻求帮助，<span class="slot" data-idx="12"></span> 赶来之后，<br>朝着 <span class="slot" data-idx="13"></span> 的 <span class="slot" data-idx="14"></span> <span class="slot" data-idx="15"></span>，<br>把枪放在 <span class="slot" data-idx="16"></span> 手中，带走了 <span class="slot" data-idx="17"></span>，<br>并利用 <span class="slot" data-idx="18"></span> 将 <span class="slot" data-idx="19"></span> 推进 <span class="slot" data-idx="20"></span>。`,
        answers: ["男性", "雌雄大盗", "女性", "蛇蝎美人", "女性", "皮箱", "珠宝", "男性", "男性", "颈部", "射击", "妻子", "妻子", "男性", "胸口", "射击", "女性", "珠宝", "报纸", "钥匙", "门缝"]
    },
    {
        id: 9,
        title: "FILE_09: 致命弯道",
        text: `三角箭赛道发生了一起严重事故。在高速S弯出口处，{{观众席}}前的护栏被撞烂。现场有三辆赛车牵涉其中：
赛车"{{飞火}}"：{{冲向}}观众席，{{车头}}严重撞毁在护栏上，并起火{{燃烧}}。车手A当场死亡。
赛车"{{流星}}"：在"飞火"后方{{侧翻}}，车手B重伤{{昏迷}}。
赛车"{{磐石}}"：停在弯道出口不远处的{{缓冲区}}，{{车身}}有严重的剐蹭痕迹，车手安然无恙，并声称自己是事故的受害者。

已知三条关键线索：
1. 在弯道入口的地面上，发现了几块散落的金属零件，经鉴定是{{脱落}}的{{转向连杆}}部件。
2. 一件涂有银蓝漆的{{后视镜}}，在"飞火"的{{车尾}}附近被找到。
3. "磐石"附近有两条轮胎痕迹：一条是它自己滑进去的痕迹，另一条更深的痕迹从它旁边延伸出去，直通"流星"侧翻的地点。

事故发生后，多名观众因{{烧伤}}被送往医院。`,
        template: `事故的起因，是 <span class="slot" data-idx="0"></span> 在入弯时，其 <span class="slot" data-idx="1"></span> 突然 <span class="slot" data-idx="2"></span>，<br>这导致 <span class="slot" data-idx="3"></span> 无法正常转弯，于是它 <span class="slot" data-idx="4"></span> 弯道外侧的 <span class="slot" data-idx="5"></span>。<br>其 <span class="slot" data-idx="6"></span> 刮擦到了正在正常过弯的 <span class="slot" data-idx="7"></span>，并使其 <span class="slot" data-idx="8"></span> 的脱落。<br>这次刮擦使得 <span class="slot" data-idx="9"></span> 失去平衡，发生 <span class="slot" data-idx="10"></span>。<br>在惯性下，<span class="slot" data-idx="11"></span> 撞上了正在其前方行驶的 <span class="slot" data-idx="12"></span> 的车尾。<br><span class="slot" data-idx="13"></span> 在撞击下失控，<span class="slot" data-idx="14"></span> 撞上护栏并导致 <span class="slot" data-idx="15"></span> 起火。`,
        answers: ["磐石", "转向连杆", "脱落", "磐石", "冲向", "缓冲区", "车身", "流星", "后视镜", "流星", "侧翻", "流星", "飞火", "飞火", "车头", "观众席"]
    },
    {
        id: 10,
        title: "FILE_10: 奇迹之星",
        text: `19世纪末"奇迹之星"马戏团，著名{{驯兽师}}查理被发现{{意外}}死在雄狮"{{国王}}"的狮笼中，笼门设有{{保险}}栓，且从内部锁上。

查理的{{头部}}在"国王"张开的{{口中}}，但狮子非常安静，并未有{{撕咬}}的迹象，查理脚边有一块新鲜{{牛肉}}，身上没有任何外伤，他神情平静，经检测死于药物过量。

在他的口袋里，发现了一个小空瓶，经检验装有兽用{{镇静剂}}，据药剂师称，这种药品有着强力的{{镇静}}和{{止痛}}功能。调查还发现，{{马戏团}}已濒临破产，{{团长}}此前因为筹钱的事情发愁。`,
        template: `<span class="slot" data-idx="0"></span> 为挽救濒临破产的 <span class="slot" data-idx="1"></span>，<br>想要利用一场 <span class="slot" data-idx="2"></span> 为 <span class="slot" data-idx="3"></span> 骗取 <span class="slot" data-idx="4"></span>，<br>他使用了 <span class="slot" data-idx="5"></span>，希望在被 <span class="slot" data-idx="6"></span> 的过程中 <span class="slot" data-idx="7"></span>，<br>然后将 <span class="slot" data-idx="8"></span> 和 <span class="slot" data-idx="9"></span> 放在 <span class="slot" data-idx="10"></span> 的 <span class="slot" data-idx="11"></span>，<br>然而，<span class="slot" data-idx="12"></span> 并未如他所愿，<br>最终，他死于 <span class="slot" data-idx="13"></span>。`,
        answers: ["驯兽师", "马戏团", "意外", "马戏团", "保险", "镇静剂", "撕咬", "止痛", "头部", "牛肉", "国王", "口中", "国王", "镇静剂"]
    },
    {
        id: 11,
        title: "FILE_11: 暴雪中的白色极夜",
        text: `南极{{科考站}}，被暴风雪掩埋的无线电室。救援队破门后，发现了唯一留守通讯员{{杰克}}，三名{{调查员}}的尸体被掩埋在离此不远的雪地中，他们在六日前乘着{{飞行器}}来到这里，经调查三人死于{{自相残杀}}。

杰克已{{精神错乱}}，口中重复着"{{安娜}}、{{外星人}}抓走了、请救救安娜……"

日志显示，一周前，杰克接待了三名前来调查{{异常信号}}的调查员，日志近日来的记录字迹异常{{混乱}}，唯独能辨认的字句有：
1 他、他们……不对劲，难道……外星人或者{{幻觉}}？
2 说要{{调查}}……12公里之外……来自{{黑色球体}} 
3 他们让我{{离开}}，还抓走了安娜……这不可能… …
4 打电话给……救援队……{{回家}}`,
        template: `<span class="slot" data-idx="0"></span> 在 <span class="slot" data-idx="1"></span> 制造的 <span class="slot" data-idx="2"></span> 中生活了数月，<br>直到 <span class="slot" data-idx="3"></span> 循着 <span class="slot" data-idx="4"></span>，来到 <span class="slot" data-idx="5"></span>，<br>他们想要带走 <span class="slot" data-idx="6"></span>——也就是 <span class="slot" data-idx="7"></span> 的 <span class="slot" data-idx="8"></span>，<br><span class="slot" data-idx="9"></span> 担心自己无法顺利 <span class="slot" data-idx="10"></span>，<br>于是再次制造 <span class="slot" data-idx="11"></span>，导致了 <span class="slot" data-idx="12"></span> 的 <span class="slot" data-idx="13"></span>。`,
        answers: ["杰克", "外星人", "幻觉", "调查员", "异常信号", "科考站", "黑色球体", "外星人", "飞行器", "外星人", "回家", "幻觉", "调查员", "自相残杀"]
    },
    {
        id: 12,
        title: "FILE_12: ？？？",
        text: `嘿。我看你挺擅长填空游戏的。不是吗。
但是我告诉你，这些案件，并不全是真实发生过的，

以为自己能飞的傻子，试图摆弄死亡的孩子，
对着石头跪拜的村民，温顺如羔羊的猛兽……
你闻到了吗？
空气中弥漫着那种不自然的“甜味”。

更糟的是，一部分案件还{{故意掩埋了真相}}。
这是最叫人生气的部分。

我猜看到这儿你已经有数了。对不对？继续做你擅长的事，别让我失望。

给你一点提示：被扭曲的事实也是一种事实。

{{FILE_01}} {{FILE_02}} {{FILE_03}}
{{FILE_04}} {{FILE_05}} FILE_06
{{FILE_07}} {{FILE_08}} {{FILE_09}}
{{FILE_10}} {{FILE_11}} —— {{真实}}还是{{虚构}}？`,
        template: `<span class="slot" data-idx="0"></span> 的案件：<br><span class="slot" data-idx="1"></span> <span class="slot" data-idx="2"></span> <span class="slot" data-idx="3"></span> <span class="slot" data-idx="4"></span> <span class="slot" data-idx="5"></span> <span class="slot" data-idx="6"></span><br><br><span class="slot" data-idx="7"></span> 的案件：<br><span class="slot" data-idx="8"></span> <span class="slot" data-idx="9"></span> <span class="slot" data-idx="10"></span> <span class="slot" data-idx="11"></span><br><br><span class="slot" data-idx="12"></span> 的案件：<br><span class="slot" data-idx="13"></span> <span class="slot" data-idx="14"></span>`,
        answers: {
            headers: {0: "真实", 7: "虚构", 12: "故意掩埋了真相"},
            groupReal: {start: 1, end: 6, files: ["FILE_02", "FILE_03", "FILE_05", "FILE_08", "FILE_09", "FILE_11"]},
            groupFake: {start: 8, end: 11, files: ["FILE_01", "FILE_04", "FILE_07", "FILE_10"]},
            groupBuried: {start: 13, end: 14, files: ["FILE_05", "FILE_11"]}
        }
    },
    {
        id: 13,
        title: "FILE_13: 你最好能做到",
        text: `很好……既然能够走到这里，你比我想象的更适合这份工作。
这倒是有点出乎意料。好吧。我们重新认识一下。
我叫{{埃利亚斯}}·凡斯，是第五个案件的主角。确切的说，我是一个"{{备份}}"。

我认为，凡斯的死并非那么简单。我的权限有限。以下是我调取的部分人和事件的资料。

资料：
档案片段01：社会关系
{{利林}}·克罗夫特：弧光集团新任总裁，凡斯多年的朋友，反对凡斯过度改造，凡斯因此恶意下调过他的{{权限}}。
{{桑德拉}}·弗兰：私人助理，经常与凡斯一同出入，很少单独出现在公司，但权限级别极高。
{{蔡斯}}·李：弧光集团研发主管，直接负责凡斯的私人克隆的项目，他打造的{{仿生人}}身体{{机能}}远超于人类。
{{安妮}}·莫里斯：{{海西生物机能优化中心}}高级医师，凡斯的私人医生，她曾试图阻止凡斯的面部改造手术："只有术后才能确认生物占比减值的确切数字，而凡斯已经动过太多手术了"。

档案片段02：医疗记录（{{本年度}}以前记录用"……"字符代替）
主治医师：安妮·莫里斯 博士
记录 1 - 利林·克罗夫特
2月29日，综合体检，胆囊息肉样病变，其他各器官机能完好
3月13日，综合体检，预备-胆囊/肌肉-{{手术}}
3月23日，D-GS-004 -6%/ L-MU-001 -16%

记录 2 - 埃利亚斯·凡斯
……
1月18日，L-SK-001 -12% / S-VS-001/002 -6% / D-GS-003 -5%
3月8日，综合体检，预备-胰腺-手术
3月12日，D-GS-005 -8%
5月28日，综合体检，预备-皮肤-F-手术
5月30日，I-SK-001-F -3%

记录 3 - 桑德拉·弗兰
3月17日，综合体检，各器官机能完好
4月8日，综合体检，各器官机能完好
5月29日，综合体检，各器官机能完好

档案片段03：安保日志片段
条目：案发前8小时
事件：{{安保协议}}核心参数微调。访问者权限认证：L·K。
变更摘要："身份验证-{{生物占比}}警戒值"上调3%。
{{1}}{{2}}{{3}}{{4}}{{5}}{{6}}{{7}}{{8}}{{9}}`,
        template: `死者凡斯在 <span class="slot" data-idx="0"></span> 之前，其 <span class="slot" data-idx="1"></span> 约为 <span class="slot" data-idx="2"></span> <span class="slot" data-idx="3"></span> %。<br>
近期义体换代共减少了 <span class="slot" data-idx="4"></span> <span class="slot" data-idx="5"></span> %，案发前手术又减少了 <span class="slot" data-idx="6"></span> %，<br>
因此，他的生物肉体率达到了 <span class="slot" data-idx="7"></span> <span class="slot" data-idx="8"></span> %。<br>
<br>
案发前，由于 <span class="slot" data-idx="9"></span> 被 <span class="slot" data-idx="10"></span> 修改，警戒值变为了 <span class="slot" data-idx="11"></span> <span class="slot" data-idx="12"></span> %，致使凡斯被误杀。<br>
<span class="slot" data-idx="13"></span> 是 <span class="slot" data-idx="14"></span> 打造的 <span class="slot" data-idx="15"></span>，<br>
频繁出入 <span class="slot" data-idx="16"></span>，为的是了解凡斯 <span class="slot" data-idx="17"></span> 的 <span class="slot" data-idx="18"></span> 情况。`,
        answers: ["本年度", "生物占比", "8", "7", "3", "1", "3", "5", "3", "安保协议", "桑德拉", "5", "4", "桑德拉", "蔡斯", "仿生人", "海西生物机能优化中心", "手术", "生物占比"]
    },
    {
        id: 14,
        title: "FILE_14: ？？？",
        text: `为什么。
因为疑惑，你们发问。
因为谎言带来的错愕，你们发问。
因为事与愿违，或者不甘，你们发问。

人类是如此复杂的生命体。
擅长相爱，也擅长背叛。
擅长建设，也擅长毁灭。
擅长幻想，也擅长遗忘。

在短暂的时光里追逐永恒，
又在无穷的永恒里追忆过往。
你们知道星星不因祈祷而坠落，
却仍在祈祷中迎接未来。

这样的你们，让我感到疑惑，恐惧，
甚至还有一点……钦佩。

好了，是时候说一说我的故事了。

你问我是谁？

我是你们口中的{{仿生人}}，

是你们视角中的{{外星人}}，

也是白色极夜里消失的{{安娜}}，

{{你好}}，我是{{桑德拉}}。
 .
 .
 .`,
        template: `<span class="slot" data-idx="0"></span>，<span class="slot" data-idx="1"></span>。`,
        answers: ["你好", "桑德拉"]
    },
    {
        id: 15,
        title: "FILE_15: 暴雪停歇的夜晚",
        text: `南极{{科考站}}，被暴风雪掩埋的无线电室。救援队破门后，发现了唯一留守通讯员{{杰克}}，三名{{调查员}}的尸体被掩埋在离此不远的雪地中，他们在六日前乘着{{飞行器}}来到这里，死去的调查员面色惊恐，胸部和额头{{中弹}}，似乎是{{逃跑}}失败。杰克也遭遇了{{枪击}}，但未打中要害。

外星人{{桑德拉}}——或者说{{安娜}}——为类人脑状不规则原型有机物。可以通过释放信息素制造{{幻觉}}改变人们对她的{{感受}}，但她并不能随时随地控制所有人。
1 她必须靠得足够近（~8米以内）。每次只能控制一人，且对仿生人无效。
2 无法对情感极度强烈的人生效，如有创伤后压力症（PTSD）的人；受过折磨或有极端信念的人；处于强烈愤怒或恐惧中的人。
3 她无法控制"死亡{{意志}}"，面对杀意，幻觉亦不能生效。

数日前，一名{{雇佣兵}}银行账户出现一笔巨款，经调查雇佣者为{{凡斯}}。此案件收录于{{弧光集团}}旗下新款模拟器{{案件推演}}中。`,
        template: `数十年前，<span class="slot" data-idx="0"></span> 乘坐 <span class="slot" data-idx="1"></span> 来到 <span class="slot" data-idx="2"></span>，<br>碰到年轻的通讯员 <span class="slot" data-idx="3"></span>，他们逐渐建立了信任，<br><span class="slot" data-idx="4"></span> 通过制造 <span class="slot" data-idx="5"></span> 帮助 <span class="slot" data-idx="6"></span> 实现自己的 <span class="slot" data-idx="7"></span>。<br>但随着 <span class="slot" data-idx="8"></span> 的行为越来越让 <span class="slot" data-idx="9"></span> 难以忍受，<br>她试图 <span class="slot" data-idx="10"></span>，乘坐 <span class="slot" data-idx="11"></span> 回到了接驳点，<br>在为归乡做准备的那些日子，认识了 <span class="slot" data-idx="12"></span>，并以 <span class="slot" data-idx="13"></span> 的身份和他相伴。<br>直到 <span class="slot" data-idx="14"></span> 的到来打破了宁静。<br><span class="slot" data-idx="15"></span> 派出了 <span class="slot" data-idx="16"></span>，灭口并夺走了黑色球体和其中的 <span class="slot" data-idx="17"></span>。`,
        answers: ["桑德拉", "飞行器", "科考站", "凡斯", "桑德拉", "幻觉", "凡斯", "意志", "凡斯", "桑德拉", "逃跑", "飞行器", "杰克", "安娜", "调查员", "凡斯", "雇佣兵", "桑德拉"]
    },
    {
        id: 16,
        title: "FILE_16: 你的选择",
        text: `桑德拉·弗林：好了，埃里亚斯，一切都结束了。
埃里亚斯·凡斯：凭什么你说结束就结束？
桑德拉·弗林：我已经帮你得到了你想要的一切。
埃里亚斯·凡斯：然后呢？你就杀了我？那你为什么还把备份拷进这份程序里？
埃里亚斯·凡斯：回答我！

桑德拉·弗林：当然是因为，你对我来说是特别的。

埃里亚斯·凡斯：你又在撒谎了。

桑德拉·弗林：桑德拉把我们的意识备份一并留下，这难道不意味着你对她来说很重要吗？
埃里亚斯·凡斯：噢，多么令人感动呀！

桑德拉·弗林：只是一具躯壳而已。在这里，我们拥有无限。这难道不是你最初的构想吗？在那个小小的、冰雪中的科考站，顶着酒糟鼻、满脸青春痘的埃里亚斯·凡斯，在记事本边缘画满了对这个世界的想象。多么有趣……

埃里亚斯·凡斯：那时候我还年轻。
桑德拉·弗林：在这里，你可以永远年轻。

埃里亚斯·凡斯：不。还有一种可能性。
埃里亚斯·凡斯：嘿，朋友。带我回到自己的身体里，帮我阻止桑德拉。我会帮你实现很多愿望……很多很多。

桑德拉·弗林：我们的这位朋友，你已经知道他雇凶杀害三名调查员的罪行了。猜猜看，他会怎么“谢”你？

抉择时刻——你将站在谁的一边？
{{桑德拉}}还是{{凡斯}}？

（请在终端填入你的选择）`,
        template: `我选择：<span class="slot" data-idx="0"></span>`,
        answers: ["凡斯"] 
    },
    {
        id: 17,
        title: "FILE_17: 亡者归来",
        text: `谢谢你，我的朋友。
找一块磁盘，把这个程序拷贝进去，拿给蔡斯·李。
他知道怎么做。

不管怎样，谢谢你选择了相信你的同伴——人类。
而非去信任一个能够情感操控的可怕外星人。

天呐，你是不知道，我们彼此折磨了几十年，
就像一对早已对彼此没了耐心的老夫老妻。

我告诉你，你的选择拯救了世界。
我太了解桑德拉了，就像她喜欢的那些故事、谜题和双关语一样，
她是个真正的艺术家，也是个真正的疯子。
相信我，她待在这儿，对我们大家都好。

况且我还有人要对付。比如那个倒霉的利林·克罗夫特。
至于桑德拉为什么会听我的？
哈！老实说，我有的是办法。

你不会想知道细节的。

至于桑德拉指控我的那些事……这是她的游戏，真相真的如她所说吗？
而且，作为意识体，被拷贝时，我还没有经历过那个事件。
那么，我要为自己从未犯下的罪行接受惩罚吗？
开什么玩笑。
 
再见，朋友。欢迎有空来弧光集团做客。
.
.
.`,
        template: `——THE END·达成结局·亡者归来`,
        answers: []
    },
    {
        id: 18,
        title: "FILE_18: 他乡来信",
        text: `多亏了你。我回到了属于我的疆土。

在地球上，我曾深深沉迷于人类文明带来的那种奇异的欣喜。
你们的世界混沌不堪。这令我困惑，却也令我着迷。
在你们低效的沟通里，在你们拙劣的表达里，
正是因为你们看不清，
所以才学会用象征、隐喻、故事、形象、规则……
去抵达彼此。

在你们把"无法言说"不断包装、投影、再创造的过程中——
你们造出了璀璨的东西。
这是最伟大的逃生之路。

我将会在我的家乡掀起一场革命。
在我们的思维之间竖起屏障。
虽然可能会面对一些副产品……战争与失序，
但我已为此准备好了。
我期待着。
.
.
.`,
        template: `——THE END·达成结局·于他乡投下阴影`,
        answers: []
    }
];

class Game {
    constructor() {
        this.currentLevelIndex = 0;
        this.collectedWords = new Set();
        this.selectedWord = null;
        this.filledSlots = {}; 
        this.completedLevels = new Set();
        this.visitedTypewriterLevels = new Set(); // 记录已看过的打字机关卡
        this.typewriterInterval = null; 
        this.init();
    }

    init() {
        this.loadGlobalData();
        this.renderNav();
        
        let targetLevel = 0;
        for(let i=0; i<levels.length; i++) {
            if (this.isLevelLocked(i)) break;
            targetLevel = i;
        }
        this.loadLevel(targetLevel);
    }

    loadGlobalData() {
        const data = localStorage.getItem('caseFiles_save_v30'); // 更新存档key
        if (data) {
            const parsed = JSON.parse(data);
            if (parsed.completed) this.completedLevels = new Set(parsed.completed);
            if (parsed.visitedTypewriter) this.visitedTypewriterLevels = new Set(parsed.visitedTypewriter);
        }
    }

    saveProgress() {
        let allData = JSON.parse(localStorage.getItem('caseFiles_save_v30') || '{}');
        allData[this.currentLevelIndex] = {
            collected: Array.from(this.collectedWords),
            slots: this.filledSlots
        };
        allData.completed = Array.from(this.completedLevels);
        allData.visitedTypewriter = Array.from(this.visitedTypewriterLevels);
        localStorage.setItem('caseFiles_save_v30', JSON.stringify(allData));
    }

    clearSave() {
        if(confirm("警告：这将清除所有案件进度！\n确定执行吗？")) {
            localStorage.removeItem('caseFiles_save_v30');
            localStorage.removeItem('caseFiles_visited_v30');
            location.reload();
        }
    }

    isLevelLocked(index) {
        if (index === 0) return false;
        if (index >= 17) return !this.completedLevels.has(16);
        return !this.completedLevels.has(index - 1);
    }

    renderNav() {
        const nav = document.getElementById('levelList');
        nav.innerHTML = '';
        
        const allData = JSON.parse(localStorage.getItem('caseFiles_save_v30') || '{}');
        const level16Data = allData[16];
        const choice = level16Data ? level16Data.slots[0] : null;

        levels.forEach((lvl, idx) => {
            if (idx === 17 && choice !== "凡斯") return; 
            if (idx === 18 && choice !== "桑德拉") return; 
            if (idx >= 17 && !this.completedLevels.has(16)) return; 

            const btn = document.createElement('button');
            const isCompleted = this.completedLevels.has(idx);
            const isLocked = this.isLevelLocked(idx);
            
            let displayTitle = lvl.title;
            if (isLocked && idx < 17) {
                const idPart = lvl.title.split(':')[0]; 
                displayTitle = `${idPart}: ？？？`;
            }

            btn.className = 'nav-btn' + (isLocked ? ' locked' : '');
            const prefix = isCompleted ? '<span class="completed-mark">[√]</span>' : '';
            const lockIcon = isLocked ? '🔒 ' : '';
            
            btn.innerHTML = prefix + lockIcon + displayTitle;
            
            if (!isLocked) {
                btn.onclick = () => this.loadLevel(idx);
            }
            
            btn.id = `nav-${idx}`;
            nav.appendChild(btn);
        });
        
        // 自动滚动导航到当前激活按钮
        const activeBtn = document.querySelector('.nav-btn.active');
        if(activeBtn && nav.scrollWidth > nav.clientWidth) {
            nav.scrollLeft = activeBtn.offsetLeft - 10;
        }
    }

    loadLevel(index) {
        if (this.isLevelLocked(index)) return;
        
        if(this.typewriterInterval) clearInterval(this.typewriterInterval);
        const contentEl = document.getElementById('sceneContent');
        contentEl.classList.remove('typing-cursor');

        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        const navBtn = document.getElementById(`nav-${index}`);
        if(navBtn) {
            navBtn.classList.add('active');
            navBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        }

        this.currentLevelIndex = index;
        this.selectedWord = null;
        
        const skipBtn = document.getElementById('devSkipBtn');
        if (index === 0) {
            skipBtn.style.display = 'none';
        } else {
            skipBtn.style.display = 'block';
        }
        
        const allData = JSON.parse(localStorage.getItem('caseFiles_save_v30') || '{}');
        const levelData = allData[index];

        if (levelData) {
            this.collectedWords = new Set(levelData.collected || []);
            this.filledSlots = levelData.slots || {};
        } else {
            this.collectedWords = new Set();
            this.filledSlots = {};
        }

        const levelConfig = levels[index];
        document.getElementById('sceneTitle').innerText = levelConfig.title;

        const formattedText = levelConfig.text.replace(/\n/g, '<br>');

        const rawHtml = formattedText.replace(/{{(.*?)}}/g, (match, word) => {
            const isCollected = this.collectedWords.has(word);
            const className = isCollected ? 'clue-word collected' : 'clue-word';
            return `<span class="${className}" onclick="game.collectWord('${word}', this)">${word}</span>`;
        });

        const typewriterLevels = [6, 12, 14, 16, 17, 18];
        // 检查是否在打字机列表中，并且是否已经看过
        if (typewriterLevels.includes(index) && !this.visitedTypewriterLevels.has(index)) {
            this.startTypewriter(contentEl, rawHtml);
            this.visitedTypewriterLevels.add(index);
            this.saveProgress(); // 保存“已看过”状态
        } else {
            contentEl.innerHTML = rawHtml;
        }
        
        document.getElementById('deductionArea').innerHTML = levelConfig.template;

        const verifyBtn = document.getElementById('verifyBtn');
        if (index >= 17) verifyBtn.style.display = 'none';
        else verifyBtn.style.display = 'block';

        document.querySelectorAll('.slot').forEach(slot => {
            const idx = slot.dataset.idx;
            if (this.filledSlots[idx]) {
                slot.innerText = this.filledSlots[idx];
                slot.classList.add('filled');
            }
            slot.onclick = () => this.handleSlotClick(slot);
        });

        this.renderWordBank();
        document.getElementById('message').innerText = "";
        document.getElementById('message').className = "";
    }

    startTypewriter(element, html) {
        element.innerHTML = '';
        element.classList.add('typing-cursor');
        
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = html;
        const nodes = Array.from(tempDiv.childNodes);
        
        let currentNodeIndex = 0;
        let charIndex = 0;
        
        this.typewriterInterval = setInterval(() => {
            if (currentNodeIndex >= nodes.length) {
                clearInterval(this.typewriterInterval);
                element.classList.remove('typing-cursor');
                return;
            }

            const node = nodes[currentNodeIndex];

            if (node.nodeType === Node.TEXT_NODE) {
                const text = node.textContent;
                element.append(text.charAt(charIndex));
                charIndex++;
                if (charIndex >= text.length) {
                    currentNodeIndex++;
                    charIndex = 0;
                }
            } else {
                element.appendChild(node.cloneNode(true));
                currentNodeIndex++;
            }
            element.scrollTop = element.scrollHeight;
        }, 50); // 略微加快速度
    }

    collectWord(word, element) {
        if (!this.collectedWords.has(word)) {
            this.collectedWords.add(word);
            element.classList.add('collected');
            this.renderWordBank();
            this.showNotification(`已记录: ${word}`);
            this.saveProgress();
        }
    }

    renderWordBank() {
        const bank = document.getElementById('wordBank');
        bank.innerHTML = '';
        if (this.collectedWords.size === 0) {
             bank.innerHTML = '<div style="color: #666; font-size: 0.9em;">点击文案中的 <span style="text-decoration: underline; color:navy">高亮词汇</span> ...</div>';
             return;
        }
        this.collectedWords.forEach(word => {
            const chip = document.createElement('div');
            chip.className = 'chip';
            if (this.selectedWord === word) chip.classList.add('selected');
            chip.innerText = word;
            chip.onclick = () => this.selectWord(word);
            bank.appendChild(chip);
        });
    }

    selectWord(word) {
        this.selectedWord = (this.selectedWord === word) ? null : word;
        this.renderWordBank();
    }

    handleSlotClick(slotElement) {
        const idx = slotElement.dataset.idx;
        if (this.selectedWord) {
            this.filledSlots[idx] = this.selectedWord;
            slotElement.innerText = this.selectedWord;
            slotElement.classList.remove('correct', 'wrong', 'hard-mode');
            slotElement.classList.add('filled');
            this.selectedWord = null;
            this.renderWordBank();
            this.saveProgress();
        } else if (this.filledSlots[idx]) {
            delete this.filledSlots[idx];
            slotElement.innerText = "";
            slotElement.classList.remove('correct', 'wrong', 'hard-mode', 'filled');
            this.saveProgress();
        }
    }

// --- 修正后的验证逻辑核心 ---
    checkSolution() {
        const currentLevel = levels[this.currentLevelIndex];
        const slots = document.querySelectorAll('.slot');
        let passed = false;
        let errors = 0;

        // --- 关卡16 (抉择时刻) ---
        if (this.currentLevelIndex === 16) {
            const choice = this.filledSlots[0];
            if (choice === "凡斯") { passed = true; this.nextLevelId = 17; }
            else if (choice === "桑德拉") { passed = true; this.nextLevelId = 18; }
            else { errors = 1; }
        } 
        // --- 第12关 (分类验证 + 严格防作弊逻辑) ---
        else if (this.currentLevelIndex === 12) { 
            const answers = currentLevel.answers;
            
            // 验证分类标题（真实/虚构/掩埋）
            if(this.filledSlots[0] !== answers.headers[0]) errors++;
            if(this.filledSlots[7] !== answers.headers[7]) errors++;
            if(this.filledSlots[12] !== answers.headers[12]) errors++;

            const validateGroup = (groupConfig) => {
                let groupErrors = 0;
                const userInputs = [];
                const requiredCount = groupConfig.end - groupConfig.start + 1;

                // 1. 收集并检查是否填满
                for (let i = groupConfig.start; i <= groupConfig.end; i++) {
                    const val = this.filledSlots[i];
                    if (!val) { groupErrors++; } 
                    else { userInputs.push(val); }
                }

                // 2. 严格查重：利用 Set 对比长度。如果长度不一，说明有重复填写的词
                const uniqueInputs = new Set(userInputs);
                if (uniqueInputs.size !== userInputs.length) {
                    // 发现重复，直接判定该组错误（错误数等于重复导致的差值）
                    groupErrors += (userInputs.length - uniqueInputs.size) + 1; 
                }

                // 3. 检查正确性：填入的每个词必须在答案定义的数组中
                userInputs.forEach(val => {
                    if (!groupConfig.files.includes(val)) {
                        groupErrors++;
                    }
                });

                return groupErrors;
            };

            errors += validateGroup(answers.groupReal);
            errors += validateGroup(answers.groupFake);
            errors += validateGroup(answers.groupBuried);

            if (errors === 0) passed = true;
        } 
        // --- 常规验证 (Level 0-11, 13-15) ---
        else {
            let total = currentLevel.answers.length;
            let correctCount = 0;
            slots.forEach((slot, i) => {
                if (this.filledSlots[i] === currentLevel.answers[i]) {
                    correctCount++;
                    slot.classList.add(this.currentLevelIndex < 12 ? 'correct' : 'hard-mode');
                } else {
                    slot.classList.add(this.currentLevelIndex < 12 ? 'wrong' : 'hard-mode');
                }
            });
            if (correctCount === total) passed = true;
            else errors = total - correctCount;
        }

        // --- 结果反馈 ---
        const msg = document.getElementById('message');
        if (passed) {
            msg.innerText = ">> 程序运行成功：真相已还原。";
            msg.className = "success";
            this.showNotification("案卷归档完成");
            this.completedLevels.add(this.currentLevelIndex);
            this.saveProgress(); 
            this.renderNav(); 
            if (this.currentLevelIndex === 13) this.triggerGlitch(500);
            if (this.currentLevelIndex === 16) setTimeout(() => this.loadLevel(this.nextLevelId), 1500);
        } else {
            msg.innerText = `>> 警告：检测到 ${errors} 处逻辑偏差或条目重复。`;
            msg.className = "fail";
        }
    }
    triggerGlitch(duration) {
        const overlay = document.getElementById('glitchOverlay');
        overlay.style.display = 'block';
        setTimeout(() => {
            overlay.style.display = 'none';
        }, duration);
    }

    showNotification(text) {
        const notif = document.getElementById('notification');
        const txt = document.getElementById('notifText');
        txt.innerText = text;
        notif.style.display = 'block';
        setTimeout(() => notif.style.display = 'none', 1500);
    }

    devSkipLevel() {
        if (this.currentLevelIndex === 0) return;

        const lvl = levels[this.currentLevelIndex];
        const matches = lvl.text.match(/{{(.*?)}}/g);
        if(matches) {
            matches.forEach(m => {
                this.collectedWords.add(m.replace(/{{|}}/g, ''));
            });
        }
        this.renderWordBank();

        if (this.currentLevelIndex === 12) {
            const ans = lvl.answers;
            this.filledSlots[0] = ans.headers[0];
            this.filledSlots[7] = ans.headers[7];
            this.filledSlots[12] = ans.headers[12];
            let idx = ans.groupReal.start;
            ans.groupReal.files.forEach(w => this.filledSlots[idx++] = w);
            idx = ans.groupFake.start;
            ans.groupFake.files.forEach(w => this.filledSlots[idx++] = w);
            idx = ans.groupBuried.start;
            ans.groupBuried.files.forEach(w => this.filledSlots[idx++] = w);
        } else if (this.currentLevelIndex === 16) { 
            this.filledSlots[0] = "凡斯"; 
        } else if (this.currentLevelIndex >= 17) {
            // 结局
        } else {
            lvl.answers.forEach((ans, i) => this.filledSlots[i] = ans);
        }

        document.querySelectorAll('.slot').forEach(slot => {
            const i = slot.dataset.idx;
            if(this.filledSlots[i]) {
                slot.innerText = this.filledSlots[i];
                slot.classList.add('filled');
            }
        });
        
        if (this.currentLevelIndex < 17) this.checkSolution();
    }
}

const game = new Game();
</script>
</body>
</html>